<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="format-detection" content="telephone=no">
<script type="text/javascript" src="bundle.js"></script>
<script type="text/javascript">
    function getFileProperties() {

        const ajax = jsUtils.ajax;
        ajax.init();
        ajax.setOnSuccess(function(xhr) {
            const directory = jsUtils.xml.getFirstFoundChildNode(xhr.responseXML, 'directory');
            const properties = jsUtils.xml.getDataInElements(directory, 'properties', ['name', 'up_path'])[0];

            document.title = properties.name;
            document.getElementById('fileNameArea').textContent = properties.name;

            const params = jsUtils.url.getRawParams();
            document.getElementById('backAnchor').href = stockerConfig.cgi_root + '/stocker.cgi?dir=' + params.dir + '&file=' + properties.up_path;

            getTextContents();
        });
        ajax.post(stockerConfig.cgi_root + '/get_dir', jsUtils.url.getQueryInUrl());
    }

    function getTextContents() {
        document.getElementById('textDataArea').textContent = "準備中";

        const ajax = jsUtils.ajax;
        ajax.init();
        ajax.setOnLoading(function() {
            document.getElementById('textDataArea').textContent = "読み込み中";
        });
        ajax.setOnSuccess(function(xhr) {
            document.getElementById('textDataArea').textContent = jsUtils.value.fixNewLine(xhr.responseText);
        });
        ajax.setOnError(function(xhr) {
            document.getElementById('textDataArea').textContent = "読み込み失敗: " + xhr.status + " " + xhr.statusText;
        });
        ajax.post(stockerConfig.cgi_root + '/get_file', jsUtils.url.getQueryInUrl() + "&mime=text/plain");
    }
</script>
<link rel="stylesheet" type="text/css" href="stocker_list.css">
<title></title>
</head>
<body>
<a id="backAnchor" href="#">← 戻る</a><br>
<h1 id="fileNameArea"></h1>
<hr>
<pre id="textDataArea"></pre>

<script type="text/javascript">
    getFileProperties();
</script>

</body>
</html>
